<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Workflows</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: #f6f7fb;
            font-family: 'Inter', Arial, sans-serif;
        }
        .navbar-custom {
            background: #f8fafc;
            box-shadow: 0 2px 8px 0 rgba(30,34,90,0.06);
            border-bottom: 1px solid #ececec;
            min-height: 60px;
        }
        .modern-card {
            border: none;
            border-radius: 18px;
            box-shadow: 0 2px 16px 0 rgba(30,34,90,0.07), 0 1.5px 4px 0 rgba(30,34,90,0.03);
            transition: box-shadow 0.2s, transform 0.2s;
            background: #fff;
        }
        .modern-card:hover {
            box-shadow: 0 6px 32px 0 rgba(30,34,90,0.13), 0 2px 8px 0 rgba(30,34,90,0.06);
            transform: translateY(-2px) scale(1.01);
        }
        .workflow-card .card-title {
            font-size: 1.08rem;
            font-weight: 600;
            color: #1a1a2f;
        }
        .workflow-card .card-text {
            color: #6c757d;
        }
        .chip {
            display: inline-block;
            padding: 2px 10px;
            font-size: 0.85em;
            border-radius: 12px;
            background: linear-gradient(90deg, #e3e6f3 60%, #f6f7fb 100%);
            color: #3a3a4a;
            margin-right: 4px;
            margin-bottom: 2px;
            font-weight: 500;
        }
        .chip.active {
            background: #0d6efd;
            color: #fff;
        }
        .filter-bar-box {
            background: #f8fafc;
            border-radius: 10px;
            box-shadow: 0 1px 4px 0 rgba(30,34,90,0.04);
            padding: 0.7rem 1.1rem;
            margin-bottom: 1.2rem;
            margin-top: 0.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            border: 1px solid #ececec;
        }
        .dropdown-menu { max-height: 300px; overflow-y: auto; }
        .autoComplete_wrapper { width: 100%; }
        .btn-modern {
            border-radius: 10px;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        .btn-outline-success, .btn-outline-primary, .btn-outline-info {
            border-width: 2px;
        }
        .btn-outline-success:hover, .btn-outline-primary:hover, .btn-outline-info:hover {
            opacity: 0.92;
        }
        .pagination .page-link {
            border-radius: 8px !important;
        }
        .favorite-btn:hover { color: #ff9800 !important; }
        .btn-outline-dark.btn-modern:hover, .btn-outline-dark.btn-modern:focus {
            background: #222;
            color: #fff;
            border-color: #222;
        }
        .selected-card {
            background: #1976d2 !important;
            border-radius: 18px !important;
            padding: 8px !important;
            box-shadow: 0 4px 24px 0 rgba(25,118,210,0.10);
            display: flex;
            align-items: stretch;
            transition: background 0.2s, padding 0.2s;
        }
        .selected-card > .card-body {
            background: #fff !important;
            border-radius: 14px !important;
            width: 100%;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 1.1rem 1.2rem !important;
        }
        .card-content-padded { padding-left: 2.2em; }
        @media (max-width: 768px) {
            .filter-bar-box { flex-direction: column; gap: 0.5rem; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-custom shadow-sm mb-2">
      <div class="container-fluid justify-content-end">
        <a href="favorites.html" class="btn btn-outline-dark btn-modern position-relative" id="goFavorites" style="font-weight:600; border-width:2px;">Favorilerim</a>
      </div>
    </nav>
    <div class="container py-3">
        <h1 class="mb-3 text-center" style="font-weight:700; letter-spacing:-1px;">n8n Workflow Repository</h1>
        <div class="filter-bar-box">
            <input type="text" id="searchInput" class="form-control flex-grow-1" placeholder="Workflow ara..." style="max-width:260px;">
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle btn-modern" type="button" id="tagDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Etiket Filtrele
                </button>
                <ul class="dropdown-menu p-2" aria-labelledby="tagDropdown" id="tagDropdownMenu" style="min-width:220px;"></ul>
            </div>
            <div class="btn-group" role="group">
                <button class="btn btn-outline-secondary sort-btn btn-modern" data-sort="name" title="İsme Göre">İsme Göre</button>
                <button class="btn btn-outline-secondary sort-btn btn-modern" data-sort="nodeCount" title="Node Sayısına Göre">Node</button>
                <button class="btn btn-outline-secondary sort-btn btn-modern" data-sort="triggerType" title="Trigger Tipine Göre">Trigger</button>
            </div>
            <select id="perPage" class="form-select d-inline-block w-auto ms-2" style="width:90px;">
                <option value="9">9</option>
                <option value="18">18</option>
                <option value="36">36</option>
                <option value="72">72</option>
                <option value="10000">Tümü</option>
            </select>
            <button class="btn btn-outline-primary btn-modern ms-2" id="downloadSelected" disabled>Seçilenleri İndir</button>
        </div>
        <div id="workflows" class="row g-4"></div>
        <div id="loading" class="text-center mt-5">Yükleniyor...</div>
        <nav>
            <ul class="pagination justify-content-center mt-4" id="pagination"></ul>
        </nav>
    </div>
    <footer class="text-center py-4 mt-5" style="color:#888; font-size:1.05em; background:transparent;">
      Bu uygulamanın tüm arayüz ve kodları <a href="https://instagram.com/bakidobur" target="_blank" style="color:#1976d2; text-decoration:none; font-weight:600;">BUCKY</a> tarafından tasarlanmıştır.
    </footer>
    <!-- Favoriler ve toplu işlem barı -->
    <!-- Bu kısmı kaldırıyoruz, favoriler butonu artık yukarıda -->
    <!-- Detay Modalı -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
          </div>
          <div class="modal-body" id="modalBody"></div>
        </div>
      </div>
    </div>
    <!-- Önizleme Modalı -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Workflow Önizleme</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
          </div>
          <div class="modal-body" id="previewBody" style="font-family:monospace; font-size:0.95em; white-space:pre; background:#f8f9fa;"></div>
        </div>
      </div>
    </div>
    <!-- Paylaşım Modalı -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Paylaşım Linki</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
          </div>
          <div class="modal-body" id="shareBody"></div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script>
    let allWorkflows = [];
    let filteredWorkflows = [];
    let selectedTags = [];
    let currentSort = 'name';
    let currentPage = 1;
    let perPage = 9;
    let allTags = [];

    async function fetchWorkflows() {
        const res = await fetch('workflow-index.json');
        const data = await res.json();
        return data.workflows;
    }
    function getAllTags(workflows) {
        const tagSet = new Set();
        workflows.forEach(wf => (wf.tags||[]).forEach(tag => tagSet.add(tag)));
        return Array.from(tagSet).sort();
    }
    function renderTagDropdown(tags) {
        const menu = document.getElementById('tagDropdownMenu');
        menu.innerHTML = tags.map(tag => `<li><a class="dropdown-item${selectedTags.includes(tag)?' active':''}" href="#" data-tag="${tag}">${tag}</a></li>`).join('');
    }
    function createWorkflowCard(wf, idx) {
        const isFav = favoriteIds.includes(wf.id);
        const isSelected = selectedIds.includes(wf.id);
        return `
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card workflow-card modern-card h-100 position-relative${isSelected ? ' selected-card' : ''}">
                <button class="favorite-btn position-absolute top-0 end-0 m-2 border-0 bg-transparent" data-fav-id="${wf.id}" title="Favorilere ekle/kaldır" style="font-size:1.5rem; color:${isFav ? '#ffc107' : '#bbb'}; z-index:2; transition:color 0.2s;">
                    ★
                </button>
                <input type="checkbox" class="form-check-input select-workflow position-absolute" data-select-id="${wf.id}" title="Toplu işlem için seç" style="top:12px; left:12px; z-index:2; width:1em; height:1em;">
                <div class="card-body d-flex flex-column card-content-padded">
                    <div class="card-title mb-1">${wf.name}</div>
                    <div class="mb-1 card-text small">${wf.description || ''}</div>
                    <div class="mb-1">
                        <span class="badge bg-primary">${wf.triggerType}</span>
                        <span class="badge bg-secondary">${wf.nodeCount} node</span>
                    </div>
                    <div class="mb-2">
                        ${(wf.tags||[]).slice(0,3).map(tag => `<span class="chip">${tag}</span>`).join(' ')}
                        ${wf.tags && wf.tags.length > 3 ? '<span class="chip">...</span>' : ''}
                    </div>
                    <div class="d-flex gap-2 mt-auto align-items-center">
                        <a href="workflows/${wf.filename}" class="btn btn-outline-success btn-sm btn-modern" target="_blank">Aç</a>
                        <a href="workflows/${wf.filename}" class="btn btn-outline-primary btn-sm btn-modern" download>İndir</a>
                        <button class="btn btn-outline-secondary btn-sm btn-modern copy-json-btn" data-copy-fn="${wf.filename}" title="JSON'u Kopyala">Kopyala</button>
                        <button class="btn btn-outline-info btn-sm btn-modern preview-btn" data-preview-fn="${wf.filename}" title="Önizle">Önizle</button>
                        <button class="btn btn-outline-dark btn-sm btn-modern share-btn" data-share-fn="${wf.filename}" title="Paylaş">Paylaş</button>
                        <button class="btn btn-outline-info btn-sm btn-modern" data-detail-idx="${idx}">Detay</button>
                    </div>
                </div>
            </div>
        </div>`;
    }
    function renderWorkflows() {
        let list = allWorkflows;
        // Arama
        const search = document.getElementById('searchInput').value.toLowerCase();
        if (search) {
            list = list.filter(wf =>
                (wf.name && wf.name.toLowerCase().includes(search)) ||
                (wf.description && wf.description.toLowerCase().includes(search)) ||
                (wf.tags && wf.tags.some(tag => tag.toLowerCase().includes(search)))
            );
        }
        // Etiket filtre
        if (selectedTags.length > 0) {
            list = list.filter(wf => selectedTags.every(tag => (wf.tags||[]).includes(tag)));
        }
        // Sıralama
        if (currentSort === 'name') {
            list = list.slice().sort((a,b) => (a.name||'').localeCompare(b.name||''));
        } else if (currentSort === 'nodeCount') {
            list = list.slice().sort((a,b) => (b.nodeCount||0)-(a.nodeCount||0));
        } else if (currentSort === 'triggerType') {
            list = list.slice().sort((a,b) => (a.triggerType||'').localeCompare(b.triggerType||''));
        }
        filteredWorkflows = list;
        renderPagination();
        renderPage();
    }
    function renderPagination() {
        const total = filteredWorkflows.length;
        const pageCount = Math.ceil(total/perPage);
        const pag = document.getElementById('pagination');
        if (pageCount <= 1) { pag.innerHTML = ''; return; }
        let html = '';
        html += `<li class="page-item${currentPage===1?' disabled':''}"><a class="page-link" href="#" data-page="${currentPage-1}">&laquo;</a></li>`;
        for(let i=1; i<=pageCount; i++) {
            if (i===1 || i===pageCount || Math.abs(i-currentPage)<=2) {
                html += `<li class="page-item${i===currentPage?' active':''}"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
            } else if (i===currentPage-3 || i===currentPage+3) {
                html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
            }
        }
        html += `<li class="page-item${currentPage===pageCount?' disabled':''}"><a class="page-link" href="#" data-page="${currentPage+1}">&raquo;</a></li>`;
        pag.innerHTML = html;
    }
    function renderPage() {
        const container = document.getElementById('workflows');
        const start = (currentPage-1)*perPage;
        const end = start+perPage;
        const pageList = filteredWorkflows.slice(start, end);
        if (pageList.length === 0) {
            container.innerHTML = '<div class="col-12 text-center text-muted">Hiç workflow bulunamadı.</div>';
            return;
        }
        container.innerHTML = pageList.map((wf,idx) => createWorkflowCard(wf, start+idx)).join('');
    }
    function showDetail(idx) {
        const wf = filteredWorkflows[idx];
        if (!wf) return;
        document.getElementById('modalTitle').textContent = wf.name;
        document.getElementById('modalBody').innerHTML = `
            <div><b>Açıklama:</b> ${wf.description||''}</div>
            <div><b>Trigger Tipi:</b> ${wf.triggerType}</div>
            <div><b>Node Sayısı:</b> ${wf.nodeCount}</div>
            <div><b>Node Tipleri:</b> ${(wf.nodeTypes||[]).join(', ')}</div>
            <div><b>Etiketler:</b> ${(wf.tags||[]).map(tag=>`<span class='chip'>${tag}</span>`).join(' ')}</div>
            <div><b>Dosya:</b> <a href="workflows/${wf.filename}" target="_blank">${wf.filename}</a></div>
        `;
        new bootstrap.Modal(document.getElementById('detailModal')).show();
    }

// --- Favoriler ve Seçili Workflow'lar ---
let favoriteIds = JSON.parse(localStorage.getItem('favorites') || '[]');
let showOnlyFavorites = false;
let selectedIds = [];

function saveFavorites() {
    localStorage.setItem('favorites', JSON.stringify(favoriteIds));
}
function updateFavoriteButtons() {
    document.querySelectorAll('.favorite-btn').forEach(btn => {
        const id = btn.getAttribute('data-fav-id');
        btn.classList.toggle('active', favoriteIds.includes(id));
        btn.style.color = favoriteIds.includes(id) ? '#ffc107' : '#bbb';
        btn.title = favoriteIds.includes(id) ? 'Favoriden çıkar' : 'Favorilere ekle';
    });
}
function updateSelectedCheckboxes() {
    document.querySelectorAll('.select-workflow').forEach(cb => {
        cb.checked = selectedIds.includes(cb.getAttribute('data-select-id'));
        // Kart arka planı için parent kartı güncelle
        const card = cb.closest('.workflow-card');
        if (card) {
            if (cb.checked) card.classList.add('selected-card');
            else card.classList.remove('selected-card');
        }
    });
}

// --- Kopyala, Önizle, Paylaş, Toplu İndir, Export/Import ---
async function fetchWorkflowFile(filename) {
    const res = await fetch('workflows/' + filename);
    return await res.text();
}
function copyToClipboard(text) {
    navigator.clipboard.writeText(text);
}
function showToast(msg) {
    let toast = document.createElement('div');
    toast.textContent = msg;
    toast.style.position = 'fixed';
    toast.style.bottom = '30px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.background = '#222';
    toast.style.color = '#fff';
    toast.style.padding = '10px 24px';
    toast.style.borderRadius = '8px';
    toast.style.zIndex = 9999;
    toast.style.fontSize = '1rem';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 1800);
}

// --- Event Binding ---
document.addEventListener('DOMContentLoaded', async () => {
    allWorkflows = await fetchWorkflows();
    document.getElementById('loading').style.display = 'none';
    allTags = getAllTags(allWorkflows);
    renderTagDropdown(allTags);
    renderWorkflows();

    // Autocomplete: src dizisi boşsa başlatma!
    const names = Array.isArray(allWorkflows) ? allWorkflows.map(wf => wf.name).filter(Boolean) : [];
    if (names.length > 0) {
        new autoComplete({
            selector: "#searchInput",
            placeHolder: "Workflow ara...",
            data: { src: names, cache: true },
            threshold: 1,
            debounce: 100,
            resultsList: {
                render: true,
                container: source => {
                    source.setAttribute("id", "autoComplete_list");
                },
                destination: document.querySelector("#searchInput"),
                position: "afterend",
                element: "ul"
            },
            resultItem: {
                content: (data, source) => {
                    source.innerHTML = data.match;
                },
                element: "li"
            },
            onSelection: feedback => {
                document.querySelector("#searchInput").value = feedback.selection.value;
                currentPage = 1;
                renderWorkflows();
            }
        });
    }

    // Arama
    document.getElementById('searchInput').addEventListener('input', function() {
        currentPage = 1;
        renderWorkflows();
    });
    // Etiket dropdown
    document.getElementById('tagDropdownMenu').addEventListener('click', function(e) {
        if (e.target.hasAttribute('data-tag')) {
            e.preventDefault();
            const tag = e.target.getAttribute('data-tag');
            if (selectedTags.includes(tag)) {
                selectedTags = selectedTags.filter(t => t!==tag);
            } else {
                selectedTags.push(tag);
            }
            currentPage = 1;
            renderTagDropdown(allTags);
            renderWorkflows();
        }
    });
    // Sıralama
    document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            currentSort = this.getAttribute('data-sort');
            renderWorkflows();
        });
    });
    // Per page
    document.getElementById('perPage').addEventListener('change', function() {
        perPage = parseInt(this.value);
        currentPage = 1;
        renderWorkflows();
    });
    // Sayfalama
    document.getElementById('pagination').addEventListener('click', function(e) {
        if (e.target.tagName==='A' && e.target.hasAttribute('data-page')) {
            e.preventDefault();
            const page = parseInt(e.target.getAttribute('data-page'));
            if (!isNaN(page) && page>=1) {
                currentPage = page;
                renderPage();
                renderPagination();
            }
        }
    });
    // Detay popup
    document.getElementById('workflows').addEventListener('click', function(e) {
        if (e.target.matches('[data-detail-idx]')) {
            showDetail(e.target.getAttribute('data-detail-idx'));
        }
    });
    // Favori butonu
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('favorite-btn')) {
            const id = e.target.getAttribute('data-fav-id');
            if (favoriteIds.includes(id)) {
                favoriteIds = favoriteIds.filter(f => f !== id);
            } else {
                favoriteIds.push(id);
            }
            saveFavorites();
            updateFavoriteButtons();
        }
    });
    // Favorilerim göster
    document.getElementById('goFavorites').addEventListener('click', function() {
        window.location.href = 'favorites.html';
    });
    // Seçili kutular
    document.body.addEventListener('change', function(e) {
        if (e.target.classList.contains('select-workflow')) {
            const id = e.target.getAttribute('data-select-id');
            if (e.target.checked) {
                if (!selectedIds.includes(id)) selectedIds.push(id);
            } else {
                selectedIds = selectedIds.filter(s => s !== id);
            }
            updateSelectedCheckboxes();
            updateDownloadSelectedButton && updateDownloadSelectedButton();
        }
    });
    document.addEventListener('DOMContentLoaded', function() {
        updateDownloadSelectedButton();
    });
    // Kopyala butonu
    document.body.addEventListener('click', async function(e) {
        if (e.target.classList.contains('copy-json-btn')) {
            const fn = e.target.getAttribute('data-copy-fn');
            const txt = await fetchWorkflowFile(fn);
            copyToClipboard(txt);
            showToast('JSON kopyalandı!');
        }
    });
    // Önizle butonu
    document.body.addEventListener('click', async function(e) {
        if (e.target.classList.contains('preview-btn')) {
            const fn = e.target.getAttribute('data-preview-fn');
            const txt = await fetchWorkflowFile(fn);
            document.getElementById('previewBody').textContent = txt.split('\n').slice(0, 20).join('\n');
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        }
    });
    // Paylaş butonu
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('share-btn')) {
            const fn = e.target.getAttribute('data-share-fn');
            const url = window.location.origin + '/workflows/' + fn;
            document.getElementById('shareBody').innerHTML = `<input class='form-control mb-2' value='${url}' readonly><button class='btn btn-outline-primary w-100 mb-2' id='copyShareLink'>Linki Kopyala</button>`;
            new bootstrap.Modal(document.getElementById('shareModal')).show();
            setTimeout(() => {
                document.getElementById('copyShareLink').onclick = () => {
                    copyToClipboard(url);
                    showToast('Link kopyalandı!');
                };
            }, 300);
        }
    });
    // Toplu indir (zip)
    const downloadBtn = document.getElementById('downloadSelected');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', async function() {
            if (selectedIds.length === 0) { showToast('Seçili workflow yok!'); return; }
            const zip = new JSZip();
            for (const id of selectedIds) {
                const wf = allWorkflows.find(w => w.id === id);
                if (wf) {
                    const content = await fetchWorkflowFile(wf.filename);
                    zip.file(wf.filename, content);
                }
            }
            const blob = await zip.generateAsync({type:'blob'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'workflows.zip';
            a.click();
            showToast('Zip indirildi!');
        });
    }
    // Favori export
    document.getElementById('exportFavorites').addEventListener('click', function() {
        const favs = favoriteIds;
        const blob = new Blob([JSON.stringify(favs)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'favoriler.json';
        a.click();
        showToast('Favoriler dışa aktarıldı!');
    });
    // Favori import
    document.getElementById('importFavorites').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
            try {
                const arr = JSON.parse(evt.target.result);
                if (Array.isArray(arr)) {
                    favoriteIds = arr;
                    saveFavorites();
                    updateFavoriteButtons();
                    showToast('Favoriler içe aktarıldı!');
                }
            } catch {}
        };
        reader.readAsText(file);
    });
});
// --- renderWorkflows override ---
const origRenderWorkflows = renderWorkflows;
renderWorkflows = function() {
    let list = allWorkflows;
    // Arama
    const search = document.getElementById('searchInput').value.toLowerCase();
    if (search) {
        list = list.filter(wf =>
            (wf.name && wf.name.toLowerCase().includes(search)) ||
            (wf.description && wf.description.toLowerCase().includes(search)) ||
            (wf.tags && wf.tags.some(tag => tag.toLowerCase().includes(search)))
        );
    }
    // Etiket filtre
    if (selectedTags.length > 0) {
        list = list.filter(wf => selectedTags.every(tag => (wf.tags||[]).includes(tag)));
    }
    // Favoriler
    if (showOnlyFavorites) {
        list = list.filter(wf => favoriteIds.includes(wf.id));
    }
    // Sıralama
    if (currentSort === 'name') {
        list = list.slice().sort((a,b) => (a.name||'').localeCompare(b.name||''));
    } else if (currentSort === 'nodeCount') {
        list = list.slice().sort((a,b) => (b.nodeCount||0)-(a.nodeCount||0));
    } else if (currentSort === 'triggerType') {
        list = list.slice().sort((a,b) => (a.triggerType||'').localeCompare(b.triggerType||''));
    }
    filteredWorkflows = list;
    renderPagination();
    renderPage();
    updateFavoriteButtons();
    updateSelectedCheckboxes();
};
// Seçili kutular güncellendiğinde butonu aktif/pasif yap
function updateDownloadSelectedButton() {
    const btn = document.getElementById('downloadSelected');
    btn.disabled = selectedIds.length === 0;
}
const origRenderWorkflows2 = renderWorkflows;
renderWorkflows = function() {
    origRenderWorkflows2();
    updateDownloadSelectedButton();
    updateSelectedCheckboxes();
};
    </script>
</body>
</html>